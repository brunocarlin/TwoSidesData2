---
title: 'exploratory data analysis: basic pandas and dplyr'
author: Bruno Carlin
date: '2019-03-23'
slug: exploratory-data-analysis-basic-pandas-and-dplyr
categories:
  - R and Python
tags:
  - R Markdown
  - reticulate
  - pandas
  - dplyr
  - tidyverse
header-includes:
  This is an basic example of how you can use either R or Python to acomplish the same goals, I really enjoy using the tidyverse but as you will see sometimes Python is just the more intuitive option.  If you find yourself confused on whether a code chunk is an R or Python code please ask me or check my github page for this project. <br> <br> 
output:
  blogdown::html_page:
    before_body: doc_prefix.html
    toc: true # table of content true
    number_sections: true  ## if you want number sections at each table header
---

This is an basic example of how you can use either R or Python to acomplish the same goals, I really enjoy using the tidyverse but as you will see sometimes Python is just the more intuitive option. If you find yourself confused on whether a code chunk is an R or Python code please ask me or check my github page for this project. <br> <br>

<div id="TOC">
<ul>
<li><a href="#getting-started-we-will-use-multiple-functions-from-both-languages"><span class="toc-section-number">1</span> Getting Started, we will use multiple functions from both languages</a><ul>
<li><a href="#how-to-set-up-reticulate"><span class="toc-section-number">1.1</span> How to set up reticulate?</a><ul>
<li><a href="#setting-root-folder"><span class="toc-section-number">1.1.1</span> Setting root folder</a></li>
<li><a href="#anchor"><span class="toc-section-number">1.1.2</span> Libraries</a></li>
</ul></li>
</ul></li>
<li><a href="#python"><span class="toc-section-number">2</span> Python</a><ul>
<li><a href="#knowing-data-frames"><span class="toc-section-number">2.1</span> Knowing data frames</a><ul>
<li><a href="#defining-pandas-series"><span class="toc-section-number">2.1.1</span> Defining pandas series</a></li>
<li><a href="#indexing"><span class="toc-section-number">2.1.2</span> Indexing</a></li>
</ul></li>
<li><a href="#combining-two-pd-series"><span class="toc-section-number">2.2</span> Combining two pd series</a><ul>
<li><a href="#create-pd-series-from-dictionary-1"><span class="toc-section-number">2.2.1</span> Create pd series from dictionary 1</a></li>
<li><a href="#combining-the-pd-series-into-a-data-frame"><span class="toc-section-number">2.2.2</span> Combining the pd series into a data frame</a></li>
<li><a href="#data-frame-properties"><span class="toc-section-number">2.2.3</span> Data frame properties</a></li>
<li><a href="#creating-some-new-columns"><span class="toc-section-number">2.2.4</span> Creating some new columns</a></li>
<li><a href="#ordering-a-data-frame"><span class="toc-section-number">2.2.5</span> Ordering a data frame</a></li>
<li><a href="#subsetting"><span class="toc-section-number">2.2.6</span> Subsetting</a></li>
</ul></li>
<li><a href="#real-data"><span class="toc-section-number">2.3</span> Real data</a><ul>
<li><a href="#reading-data"><span class="toc-section-number">2.3.1</span> Reading data</a></li>
<li><a href="#py_types_columns"><span class="toc-section-number">2.3.2</span> Variable types</a></li>
<li><a href="#basic-description"><span class="toc-section-number">2.3.3</span> Basic Description</a></li>
<li><a href="#subsetting-data"><span class="toc-section-number">2.3.4</span> Subsetting data</a></li>
<li><a href="#creating-new-columns-with-real-data"><span class="toc-section-number">2.3.5</span> Creating new columns with real data</a></li>
<li><a href="#creating-a-new-smaller-data-frame"><span class="toc-section-number">2.3.6</span> Creating a new smaller data frame</a></li>
<li><a href="#plotting-an-line-plot"><span class="toc-section-number">2.3.7</span> Plotting an line plot</a></li>
<li><a href="#filtering_py"><span class="toc-section-number">2.3.8</span> Filtering and replace data</a></li>
<li><a href="#groupby-example"><span class="toc-section-number">2.3.9</span> Groupby example</a></li>
<li><a href="#ploting-an-histogram"><span class="toc-section-number">2.3.10</span> Ploting an histogram</a></li>
<li><a href="#missing_values_py"><span class="toc-section-number">2.3.11</span> Handling Missing values</a></li>
<li><a href="#replacing-names-with-an-dictionary"><span class="toc-section-number">2.3.12</span> Replacing names with an dictionary</a></li>
</ul></li>
<li><a href="#passing-objects"><span class="toc-section-number">2.4</span> Passing Objects</a><ul>
<li><a href="#python-to-r"><span class="toc-section-number">2.4.1</span> Python to R</a></li>
</ul></li>
</ul></li>
<li><a href="#r"><span class="toc-section-number">3</span> R</a><ul>
<li><a href="#knowing-data-frames-1"><span class="toc-section-number">3.1</span> Knowing data frames</a><ul>
<li><a href="#defining-an-data-frame"><span class="toc-section-number">3.1.1</span> Defining an data frame</a></li>
<li><a href="#index-search"><span class="toc-section-number">3.1.2</span> Index search</a></li>
</ul></li>
<li><a href="#creating-an-data-frame-from-two-r-series"><span class="toc-section-number">3.2</span> Creating an data frame from two R series</a><ul>
<li><a href="#create-a-date-frame-using-an-list"><span class="toc-section-number">3.2.1</span> Create a date frame using an list</a></li>
<li><a href="#create-a-date-frame-using-an-list-2"><span class="toc-section-number">3.2.2</span> Create a date frame using an list 2</a></li>
<li><a href="#subsetting-an-data-frame-using-join-or-cbind"><span class="toc-section-number">3.2.3</span> Subsetting an data frame using join or cbind</a></li>
<li><a href="#some-info-on-our-data-frame"><span class="toc-section-number">3.2.4</span> Some info on our data frame</a></li>
<li><a href="#creating-new-columns-using-mutate-and-basic-r"><span class="toc-section-number">3.2.5</span> Creating new columns using mutate and basic R</a></li>
<li><a href="#ordering-an-data-frame-using-the-tidy-way-arrange-or-order."><span class="toc-section-number">3.2.6</span> Ordering an data frame using the tidy way arrange or order.</a></li>
<li><a href="#filtering-rows-using-standard-r-code-or-filter."><span class="toc-section-number">3.2.7</span> Filtering rows using standard R code or filter.</a></li>
</ul></li>
<li><a href="#real-case"><span class="toc-section-number">3.3</span> Real Case</a><ul>
<li><a href="#two-way-of-importing-an-csv"><span class="toc-section-number">3.3.1</span> Two way of importing an csv</a></li>
<li><a href="#lets-look-at-our-data"><span class="toc-section-number">3.3.2</span> Let’s look at our data</a></li>
<li><a href="#r_types_columns"><span class="toc-section-number">3.3.3</span> Types of columns r</a></li>
<li><a href="#basic-description-real-data-using-glimpse-and-str"><span class="toc-section-number">3.3.4</span> Basic Description real data using Glimpse and str</a></li>
<li><a href="#subsetting-data-with-select-or-base-r"><span class="toc-section-number">3.3.5</span> Subsetting Data with select or base R</a></li>
<li><a href="#creating-a-new-smaller-data-frame-using-transmute-and-base"><span class="toc-section-number">3.3.6</span> Creating a new smaller data frame using transmute and base</a></li>
<li><a href="#ploting-with-ggplot"><span class="toc-section-number">3.3.7</span> Ploting with ggplot</a></li>
<li><a href="#filtering_r"><span class="toc-section-number">3.3.8</span> Filtering and replace data</a></li>
<li><a href="#groupby-example-in-tidyverse"><span class="toc-section-number">3.3.9</span> Groupby example in tidyverse</a></li>
<li><a href="#ploting-an-histogram-using-ggplot2"><span class="toc-section-number">3.3.10</span> Ploting an histogram using ggplot2</a></li>
<li><a href="#missing_values_r"><span class="toc-section-number">3.3.11</span> Handling Missing values in R</a></li>
<li><a href="#replacing-names-with-an-case-when-aproach"><span class="toc-section-number">3.3.12</span> Replacing names with an case when aproach</a></li>
</ul></li>
<li><a href="#passing-objects-to-python"><span class="toc-section-number">3.4</span> Passing Objects to Python</a></li>
</ul></li>
</ul>
</div>

<p>I am currently doing exercises from <a href="https://github.com/sn3fru/datascience_course">digital house brasil</a></p>
<div id="getting-started-we-will-use-multiple-functions-from-both-languages" class="section level1">
<h1><span class="header-section-number">1</span> Getting Started, we will use multiple functions from both languages</h1>
<div id="how-to-set-up-reticulate" class="section level2">
<h2><span class="header-section-number">1.1</span> How to set up reticulate?</h2>
<div id="setting-root-folder" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Setting root folder</h3>
<p>I recommend using the Files tab to find the your system path to the folder containig all the data.</p>
<p>Use opts_knit to guarantee that your markdown functions will search for files
in the folder specified, it is better that setwd() because it works on
all languages.</p>
<pre class="r"><code>knitr::opts_knit$set(root.dir = normalizePath(
  &quot;~/R/Blog/content/post/2019/2019-03/2019-03-23/1&quot;))</code></pre>
</div>
<div id="anchor" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Libraries</h3>
<img src="https://media.giphy.com/media/8YZEKuDRHPtgZTx7Rv/giphy.gif" />
<details>
<summary>R part</summary>
<p>
<pre class="r"><code>library(reticulate)
library(caTools)
library(roperators)
library(tidyverse)
set.seed(123)</code></pre>
</p>
</details>
<details>
<summary>Python part</summary>
<p>
<p>I am using my second virtual conda if you have just the root
switch to conda_list()[[1]][1].</p>
<pre class="r"><code>conda_list()[[1]][2] %&gt;% 
  use_condaenv(required = TRUE)</code></pre>
<p>Let’s see what version of python this env is running.</p>
<pre class="python"><code>import platform
print(platform.python_version())</code></pre>
<pre><code>## 3.7.2</code></pre>
<p>Some basic Data Science Libraries.</p>
<pre class="python"><code>import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import os</code></pre>
</p>
</details>
</div>
</div>
</div>
<div id="python" class="section level1">
<h1><span class="header-section-number">2</span> Python</h1>
<div id="knowing-data-frames" class="section level2">
<h2><span class="header-section-number">2.1</span> Knowing data frames</h2>
<div id="defining-pandas-series" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Defining pandas series</h3>
<p><img src="https://media.giphy.com/media/EPcvhM28ER9XW/giphy.gif" /></p>
<pre class="python"><code>data = pd.Series([0.25, 0.5, 0.75, 1.0])
data</code></pre>
<pre><code>## 0    0.25
## 1    0.50
## 2    0.75
## 3    1.00
## dtype: float64</code></pre>
<pre class="python"><code>data.values</code></pre>
<pre><code>## array([0.25, 0.5 , 0.75, 1.  ])</code></pre>
<pre class="python"><code>data.index</code></pre>
<pre><code>## RangeIndex(start=0, stop=4, step=1)</code></pre>
<pre class="python"><code>data[1]</code></pre>
<pre><code>## 0.5</code></pre>
<pre class="python"><code>data[1:3]</code></pre>
<pre><code>## 1    0.50
## 2    0.75
## dtype: float64</code></pre>
</div>
<div id="indexing" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Indexing</h3>
<pre class="python"><code>data = pd.Series([0.25, 0.5, 0.75, 1.0],
                 index=[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;])
data</code></pre>
<pre><code>## a    0.25
## b    0.50
## c    0.75
## d    1.00
## dtype: float64</code></pre>
<pre class="python"><code>data[&#39;b&#39;]</code></pre>
<pre><code>## 0.5</code></pre>
</div>
</div>
<div id="combining-two-pd-series" class="section level2">
<h2><span class="header-section-number">2.2</span> Combining two pd series</h2>
<div id="create-pd-series-from-dictionary-1" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Create pd series from dictionary 1</h3>
<pre class="python"><code>population_dict = {&#39;California&#39;: 38332521,
                   &#39;Florida&#39;: 19552860,
                   &#39;Illinois&#39;: 12882135,
                   &#39;New York&#39;: 19651127,  
                   &#39;Texas&#39;: 26448193,}
population = pd.Series(population_dict)

population</code></pre>
<pre><code>## California    38332521
## Florida       19552860
## Illinois      12882135
## New York      19651127
## Texas         26448193
## dtype: int64</code></pre>
<pre class="python"><code>population[&#39;California&#39;]</code></pre>
<pre><code>## 38332521</code></pre>
<pre class="python"><code>population[&#39;California&#39;:&#39;Illinois&#39;]</code></pre>
<pre><code>## California    38332521
## Florida       19552860
## Illinois      12882135
## dtype: int64</code></pre>
<p>one more example.</p>
<pre class="python"><code>area_dict = {&#39;California&#39;: 423967, 
             &#39;Florida&#39;: 170312,
             &#39;Illinois&#39;: 149995,
             &#39;New York&#39;: 141297,
             &#39;Texas&#39;: 695662}
             
area = pd.Series(area_dict)

area</code></pre>
<pre><code>## California    423967
## Florida       170312
## Illinois      149995
## New York      141297
## Texas         695662
## dtype: int64</code></pre>
</div>
<div id="combining-the-pd-series-into-a-data-frame" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Combining the pd series into a data frame</h3>
<pre class="python"><code>states = pd.DataFrame({&#39;population&#39;: population,
                       &#39;area&#39;: area})
states</code></pre>
<pre><code>##             population    area
## California    38332521  423967
## Florida       19552860  170312
## Illinois      12882135  149995
## New York      19651127  141297
## Texas         26448193  695662</code></pre>
<pre class="python"><code>type(states)</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</code></pre>
<pre class="python"><code>type(states[&quot;population&quot;])</code></pre>
<pre><code>## &lt;class &#39;pandas.core.series.Series&#39;&gt;</code></pre>
<pre class="python"><code>type([states[&quot;population&quot;]])</code></pre>
<pre><code>## &lt;class &#39;list&#39;&gt;</code></pre>
</div>
<div id="data-frame-properties" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Data frame properties</h3>
<pre class="python"><code>states.shape</code></pre>
<pre><code>## (5, 2)</code></pre>
<pre class="python"><code>states.info()</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## Index: 5 entries, California to Texas
## Data columns (total 2 columns):
## population    5 non-null int64
## area          5 non-null int64
## dtypes: int64(2)
## memory usage: 280.0+ bytes</code></pre>
<pre class="python"><code>states.index</code></pre>
<pre><code>## Index([&#39;California&#39;, &#39;Florida&#39;, &#39;Illinois&#39;, &#39;New York&#39;, &#39;Texas&#39;], dtype=&#39;object&#39;)</code></pre>
<pre class="python"><code>states.columns</code></pre>
<pre><code>## Index([&#39;population&#39;, &#39;area&#39;], dtype=&#39;object&#39;)</code></pre>
<pre class="python"><code>states[&#39;area&#39;]</code></pre>
<pre><code>## California    423967
## Florida       170312
## Illinois      149995
## New York      141297
## Texas         695662
## Name: area, dtype: int64</code></pre>
</div>
<div id="creating-some-new-columns" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Creating some new columns</h3>
<pre class="python"><code>states[&#39;density&#39;] = states[&#39;population&#39;] / states[&#39;area&#39;]
states</code></pre>
<pre><code>##             population    area     density
## California    38332521  423967   90.413926
## Florida       19552860  170312  114.806121
## Illinois      12882135  149995   85.883763
## New York      19651127  141297  139.076746
## Texas         26448193  695662   38.018740</code></pre>
</div>
<div id="ordering-a-data-frame" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Ordering a data frame</h3>
<pre class="python"><code>states.sort_values([&#39;population&#39;], ascending = True)</code></pre>
<pre><code>##             population    area     density
## Illinois      12882135  149995   85.883763
## Florida       19552860  170312  114.806121
## New York      19651127  141297  139.076746
## Texas         26448193  695662   38.018740
## California    38332521  423967   90.413926</code></pre>
<pre class="python"><code>states.sort_values([&#39;area&#39;], ascending = True)</code></pre>
<pre><code>##             population    area     density
## New York      19651127  141297  139.076746
## Illinois      12882135  149995   85.883763
## Florida       19552860  170312  114.806121
## California    38332521  423967   90.413926
## Texas         26448193  695662   38.018740</code></pre>
<pre class="python"><code>states.sort_values([&#39;density&#39;], ascending = True)</code></pre>
<pre><code>##             population    area     density
## Texas         26448193  695662   38.018740
## Illinois      12882135  149995   85.883763
## California    38332521  423967   90.413926
## Florida       19552860  170312  114.806121
## New York      19651127  141297  139.076746</code></pre>
</div>
<div id="subsetting" class="section level3">
<h3><span class="header-section-number">2.2.6</span> Subsetting</h3>
<pre class="python"><code>states[&#39;Florida&#39;:&#39;Illinois&#39;]</code></pre>
<pre><code>##           population    area     density
## Florida     19552860  170312  114.806121
## Illinois    12882135  149995   85.883763</code></pre>
<pre class="python"><code>states[1:3]</code></pre>
<pre><code>##           population    area     density
## Florida     19552860  170312  114.806121
## Illinois    12882135  149995   85.883763</code></pre>
<pre class="python"><code>data_pop = (states[&#39;population&#39;] &gt; 19552860) &amp; (states[&#39;area&#39;]&gt;423967)

data_pop</code></pre>
<pre><code>## California    False
## Florida       False
## Illinois      False
## New York      False
## Texas          True
## dtype: bool</code></pre>
<pre class="python"><code>states[(states[&#39;population&#39;] &gt; 19552860) &amp; (states[&#39;area&#39;]&gt;423967)]</code></pre>
<pre><code>##        population    area   density
## Texas    26448193  695662  38.01874</code></pre>
<pre class="python"><code>states[[&#39;area&#39;,&#39;density&#39;]]</code></pre>
<pre><code>##               area     density
## California  423967   90.413926
## Florida     170312  114.806121
## Illinois    149995   85.883763
## New York    141297  139.076746
## Texas       695662   38.018740</code></pre>
<pre class="python"><code>states[states.density &gt; 100]</code></pre>
<pre><code>##           population    area     density
## Florida     19552860  170312  114.806121
## New York    19651127  141297  139.076746</code></pre>
<pre class="python"><code>states.loc[states.density &gt; 100, [&#39;population&#39;, &#39;density&#39;]]</code></pre>
<pre><code>##           population     density
## Florida     19552860  114.806121
## New York    19651127  139.076746</code></pre>
<pre class="python"><code>states.loc[states.density &gt; 100][[&#39;population&#39;, &#39;density&#39;]]</code></pre>
<pre><code>##           population     density
## Florida     19552860  114.806121
## New York    19651127  139.076746</code></pre>
<pre class="python"><code>states.loc[&#39;California&#39;, &#39;density&#39;]</code></pre>
<pre><code>## 90.41392608386974</code></pre>
<pre class="python"><code>states.loc[&#39;California&#39;][[&#39;density&#39;]]</code></pre>
<pre><code>## density    90.413926
## Name: California, dtype: float64</code></pre>
<pre class="python"><code>states.iloc[0, 2]</code></pre>
<pre><code>## 90.41392608386974</code></pre>
</div>
</div>
<div id="real-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Real data</h2>
<div id="reading-data" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Reading data</h3>
<pre class="python"><code>sales = pd.DataFrame(pd.read_csv(&#39;data/2019-03-23-exploratory-data-analysis-basic-pandas-and-dplyr/UKretail.csv&#39;,encoding=&#39;latin&#39;))</code></pre>
<pre class="python"><code>sales.head()</code></pre>
<pre><code>##   InvoiceNo StockCode  ... CustomerID         Country
## 0    536365     22752  ...    17850.0  United Kingdom
## 1    536365     71053  ...    17850.0  United Kingdom
## 2    536365    84029G  ...    17850.0  United Kingdom
## 3    536365    85123A  ...    17850.0  United Kingdom
## 4    536366     22633  ...    17850.0  United Kingdom
## 
## [5 rows x 8 columns]</code></pre>
<pre class="python"><code>sales.tail(3)</code></pre>
<pre><code>##        InvoiceNo StockCode  ... CustomerID  Country
## 325142    581587     22899  ...    12680.0   France
## 325143    581587     23254  ...    12680.0   France
## 325144    581587     23256  ...    12680.0   France
## 
## [3 rows x 8 columns]</code></pre>
<pre class="python"><code>sales.index</code></pre>
<pre><code>## RangeIndex(start=0, stop=325145, step=1)</code></pre>
</div>
<div id="py_types_columns" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Variable types</h3>
<p>If you need to <a href="#r_types_columns">return</a>.</p>
<pre class="python"><code>type(sales)
</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</code></pre>
<pre class="python"><code>type(sales[&quot;CustomerID&quot;])</code></pre>
<pre><code>## &lt;class &#39;pandas.core.series.Series&#39;&gt;</code></pre>
<pre class="python"><code>type([sales[&quot;CustomerID&quot;]])
</code></pre>
<pre><code>## &lt;class &#39;list&#39;&gt;</code></pre>
</div>
<div id="basic-description" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Basic Description</h3>
<pre class="python"><code>sales.shape
</code></pre>
<pre><code>## (325145, 8)</code></pre>
<pre class="python"><code>sales.columns.values
</code></pre>
<pre><code>## array([&#39;InvoiceNo&#39;, &#39;StockCode&#39;, &#39;Description&#39;, &#39;Quantity&#39;, &#39;InvoiceDate&#39;,
##        &#39;UnitPrice&#39;, &#39;CustomerID&#39;, &#39;Country&#39;], dtype=object)</code></pre>
<pre class="python"><code>sales.info()
</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## RangeIndex: 325145 entries, 0 to 325144
## Data columns (total 8 columns):
## InvoiceNo      325145 non-null object
## StockCode      325145 non-null object
## Description    324275 non-null object
## Quantity       325145 non-null int64
## InvoiceDate    325145 non-null object
## UnitPrice      325145 non-null float64
## CustomerID     244154 non-null float64
## Country        325145 non-null object
## dtypes: float64(2), int64(1), object(5)
## memory usage: 19.8+ MB</code></pre>
<pre class="python"><code>sales.describe()</code></pre>
<pre><code>##             Quantity      UnitPrice     CustomerID
## count  325145.000000  325145.000000  244154.000000
## mean        9.273340       4.845239   15288.823120
## std       154.394112     116.830451    1713.496816
## min    -80995.000000  -11062.060000   12347.000000
## 25%         1.000000       1.250000   13959.000000
## 50%         3.000000       2.080000   15150.000000
## 75%        10.000000       4.130000   16792.750000
## max     12540.000000   38970.000000   18287.000000</code></pre>
</div>
<div id="subsetting-data" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Subsetting data</h3>
<pre class="python"><code>sales[:4]</code></pre>
<pre><code>##   InvoiceNo StockCode  ... CustomerID         Country
## 0    536365     22752  ...    17850.0  United Kingdom
## 1    536365     71053  ...    17850.0  United Kingdom
## 2    536365    84029G  ...    17850.0  United Kingdom
## 3    536365    85123A  ...    17850.0  United Kingdom
## 
## [4 rows x 8 columns]</code></pre>
<pre class="python"><code>sales[&quot;CustomerID&quot;].head()</code></pre>
<pre><code>## 0    17850.0
## 1    17850.0
## 2    17850.0
## 3    17850.0
## 4    17850.0
## Name: CustomerID, dtype: float64</code></pre>
<pre class="python"><code>sales.loc[:,[&#39;Quantity&#39;]].head()</code></pre>
<pre><code>##    Quantity
## 0         2
## 1         6
## 2         6
## 3         6
## 4         6</code></pre>
<pre class="python"><code>sales.iloc[:,[3]].head()</code></pre>
<pre><code>##    Quantity
## 0         2
## 1         6
## 2         6
## 3         6
## 4         6</code></pre>
<pre class="python"><code>sales.iloc[0:6,2:3]</code></pre>
<pre><code>##                            Description
## 0         SET 7 BABUSHKA NESTING BOXES
## 1                  WHITE METAL LANTERN
## 2  KNITTED UNION FLAG HOT WATER BOTTLE
## 3   WHITE HANGING HEART T-LIGHT HOLDER
## 4               HAND WARMER UNION JACK
## 5             HOME BUILDING BLOCK WORD</code></pre>
</div>
<div id="creating-new-columns-with-real-data" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Creating new columns with real data</h3>
<pre class="python"><code>sales[&quot;Revenue&quot;] = sales.Quantity * sales.UnitPrice</code></pre>
<pre class="python"><code>sales.head()</code></pre>
<pre><code>##   InvoiceNo StockCode  ...         Country  Revenue
## 0    536365     22752  ...  United Kingdom    15.30
## 1    536365     71053  ...  United Kingdom    20.34
## 2    536365    84029G  ...  United Kingdom    20.34
## 3    536365    85123A  ...  United Kingdom    15.30
## 4    536366     22633  ...  United Kingdom    11.10
## 
## [5 rows x 9 columns]</code></pre>
</div>
<div id="creating-a-new-smaller-data-frame" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Creating a new smaller data frame</h3>
<pre class="python"><code>raw_sales = sales[[&quot;Quantity&quot;,&quot;UnitPrice&quot;, &quot;Revenue&quot;]]

raw_sales.head()</code></pre>
<pre><code>##    Quantity  UnitPrice  Revenue
## 0         2       7.65    15.30
## 1         6       3.39    20.34
## 2         6       3.39    20.34
## 3         6       2.55    15.30
## 4         6       1.85    11.10</code></pre>
<pre class="python"><code>raw_sales.info()</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## RangeIndex: 325145 entries, 0 to 325144
## Data columns (total 3 columns):
## Quantity     325145 non-null int64
## UnitPrice    325145 non-null float64
## Revenue      325145 non-null float64
## dtypes: float64(2), int64(1)
## memory usage: 7.4 MB</code></pre>
</div>
<div id="plotting-an-line-plot" class="section level3">
<h3><span class="header-section-number">2.3.7</span> Plotting an line plot</h3>
<pre class="python"><code>import matplotlib as plt
from pylab import *

sales.plot(x=&quot;InvoiceDate&quot;, y=&quot;Revenue&quot;, kind=&quot;line&quot;)

plt.show()</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-34-1.png" width="672" /></p>
</div>
<div id="filtering_py" class="section level3">
<h3><span class="header-section-number">2.3.8</span> Filtering and replace data</h3>
<p>To <a href="#filtering_r">return</a></p>
<pre class="python"><code>cancels = sales[sales[&quot;Revenue&quot;]&lt;0]
cancels.shape</code></pre>
<pre><code>## (5588, 9)</code></pre>
<pre class="python"><code>sales.drop(cancels.index, inplace=True)
sales.shape</code></pre>
<pre><code>## (319557, 9)</code></pre>
</div>
<div id="groupby-example" class="section level3">
<h3><span class="header-section-number">2.3.9</span> Groupby example</h3>
<pre class="python"><code>CountryGroups = sales.groupby([&quot;Country&quot;])[&quot;Revenue&quot;].sum().reset_index()
CountryGroups.sort_values(by= &quot;Revenue&quot;, ascending=False)</code></pre>
<pre><code>##                  Country      Revenue
## 36        United Kingdom  5311080.101
## 10                  EIRE   176304.590
## 24           Netherlands   165582.790
## 14               Germany   138778.440
## 13                France   127193.680
## 0              Australia    79197.590
## 31                 Spain    36116.710
## 33           Switzerland    34315.240
## 3                Belgium    24014.970
## 25                Norway    23182.220
## 32                Sweden    21762.450
## 20                 Japan    21072.590
## 27              Portugal    20109.410
## 30             Singapore    13383.590
## 6        Channel Islands    12556.740
## 12               Finland    12362.880
## 9                Denmark    11739.370
## 19                 Italy    10837.890
## 16             Hong Kong     8227.020
## 7                 Cyprus     7781.900
## 1                Austria     6100.960
## 18                Israel     4225.780
## 26                Poland     3974.080
## 37           Unspecified     2898.650
## 15                Greece     2677.570
## 17               Iceland     2461.230
## 34                   USA     2388.740
## 5                 Canada     2093.390
## 23                 Malta     1318.990
## 35  United Arab Emirates     1277.500
## 21               Lebanon     1120.530
## 22             Lithuania     1038.560
## 11    European Community      876.550
## 4                 Brazil      602.310
## 28                   RSA      573.180
## 8         Czech Republic      488.580
## 2                Bahrain      343.400
## 29          Saudi Arabia       90.720</code></pre>
</div>
<div id="ploting-an-histogram" class="section level3">
<h3><span class="header-section-number">2.3.10</span> Ploting an histogram</h3>
<pre class="python"><code>sales[sales[&quot;CustomerID&quot;] == 17850.0][&quot;Revenue&quot;].plot(kind=&quot;hist&quot;)
plt.show()</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-37-1.png" width="672" /></p>
<p>another example.</p>
<pre class="python"><code>sales[sales[&quot;StockCode&quot;] == &#39;71053&#39;][&quot;Quantity&quot;].hist()
plt.show()</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-38-1.png" width="672" /></p>
</div>
<div id="missing_values_py" class="section level3">
<h3><span class="header-section-number">2.3.11</span> Handling Missing values</h3>
<p>to <a href="#missing_values_r">return</a></p>
<pre class="python"><code>sales.info()</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## Int64Index: 319557 entries, 0 to 325144
## Data columns (total 9 columns):
## InvoiceNo      319557 non-null object
## StockCode      319557 non-null object
## Description    318687 non-null object
## Quantity       319557 non-null int64
## InvoiceDate    319557 non-null object
## UnitPrice      319557 non-null float64
## CustomerID     238801 non-null float64
## Country        319557 non-null object
## Revenue        319557 non-null float64
## dtypes: float64(3), int64(1), object(5)
## memory usage: 24.4+ MB</code></pre>
<pre class="python"><code>sales.CustomerID.value_counts(dropna=False).nlargest(3)</code></pre>
<pre><code>## NaN        80756
## 17841.0     4702
## 14911.0     3449
## Name: CustomerID, dtype: int64</code></pre>
<pre class="python"><code>sales.CustomerID.fillna(0, inplace=True)

sales[sales.CustomerID.isnull()]</code></pre>
<pre><code>## Empty DataFrame
## Columns: [InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, Country, Revenue]
## Index: []</code></pre>
<pre class="python"><code>sales.info()</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## Int64Index: 319557 entries, 0 to 325144
## Data columns (total 9 columns):
## InvoiceNo      319557 non-null object
## StockCode      319557 non-null object
## Description    318687 non-null object
## Quantity       319557 non-null int64
## InvoiceDate    319557 non-null object
## UnitPrice      319557 non-null float64
## CustomerID     319557 non-null float64
## Country        319557 non-null object
## Revenue        319557 non-null float64
## dtypes: float64(3), int64(1), object(5)
## memory usage: 24.4+ MB</code></pre>
</div>
<div id="replacing-names-with-an-dictionary" class="section level3">
<h3><span class="header-section-number">2.3.12</span> Replacing names with an dictionary</h3>
<pre class="python"><code>mymap = {&#39;United Kingdom&#39;:1, &#39;Netherlands&#39;:2, &#39;Germany&#39;:3, &#39;France&#39;:4, &#39;USA&#39;:5}       

sales = sales.applymap(lambda s: mymap.get(s) if s in mymap else s)

sales.head()</code></pre>
<pre><code>##   InvoiceNo StockCode  ... Country  Revenue
## 0    536365     22752  ...       1    15.30
## 1    536365     71053  ...       1    20.34
## 2    536365    84029G  ...       1    20.34
## 3    536365    85123A  ...       1    15.30
## 4    536366     22633  ...       1    11.10
## 
## [5 rows x 9 columns]</code></pre>
<pre class="python"><code>sales.Country.value_counts().nlargest(7)</code></pre>
<pre><code>## 1          292640
## 3            5466
## 4            5026
## EIRE         4789
## Spain        1420
## 2            1393
## Belgium      1191
## Name: Country, dtype: int64</code></pre>
</div>
</div>
<div id="passing-objects" class="section level2">
<h2><span class="header-section-number">2.4</span> Passing Objects</h2>
<div id="python-to-r" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Python to R</h3>
<pre class="python"><code>data2 = pd.Series([0.25, 0.5, 0.75, 1.0])</code></pre>
<pre class="r"><code>data_t = py$data2</code></pre>
<pre class="r"><code>data_t</code></pre>
<pre><code>##    0    1    2    3 
## 0.25 0.50 0.75 1.00</code></pre>
</div>
</div>
</div>
<div id="r" class="section level1">
<h1><span class="header-section-number">3</span> R</h1>
<div id="knowing-data-frames-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Knowing data frames</h2>
<div id="defining-an-data-frame" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Defining an data frame</h3>
<p>tidy way <img src="https://media.giphy.com/media/kKLr7rlj0KwjFfCxHJ/giphy.gif" /></p>
<pre class="r"><code>data &lt;-  tibble(0.25, 0.5, 0.75, 1.0)
data</code></pre>
<pre><code>## # A tibble: 1 x 4
##   `0.25` `0.5` `0.75`   `1`
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1   0.25   0.5   0.75     1</code></pre>
<pre class="r"><code>data[2]</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `0.5`
##   &lt;dbl&gt;
## 1   0.5</code></pre>
<pre class="r"><code>data[2:3]</code></pre>
<pre><code>## # A tibble: 1 x 2
##   `0.5` `0.75`
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1   0.5   0.75</code></pre>
<p>Not using tidyverse.</p>
<pre class="r"><code>data &lt;-  data.frame(c(0.25, 0.5, 0.75, 1.0))
rownames(data) &lt;- 1:nrow(data)
colnames(data) &lt;- &quot;nope&quot;
data</code></pre>
<pre><code>##   nope
## 1 0.25
## 2 0.50
## 3 0.75
## 4 1.00</code></pre>
</div>
<div id="index-search" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Index search</h3>
<pre class="r"><code>data &lt;-  data.frame(c(0.25, 0.5, 0.75, 1.0),row.names = c(&quot;a&quot;, &quot;b&quot;,&quot;c&quot;,&quot;d&quot;))
data</code></pre>
<pre><code>##   c.0.25..0.5..0.75..1.
## a                  0.25
## b                  0.50
## c                  0.75
## d                  1.00</code></pre>
<pre class="r"><code>data[&quot;b&quot;,]</code></pre>
<pre><code>## [1] 0.5</code></pre>
</div>
</div>
<div id="creating-an-data-frame-from-two-r-series" class="section level2">
<h2><span class="header-section-number">3.2</span> Creating an data frame from two R series</h2>
<div id="create-a-date-frame-using-an-list" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Create a date frame using an list</h3>
<pre class="r"><code>population_dict &lt;- list(
  &#39;California&#39; = 38332521,
  &#39;Florida&#39; = 19552860,
  &#39;Illinois&#39; = 12882135,
  &#39;New York&#39; = 19651127,
  &#39;Texas&#39; = 26448193
  )
population &lt;- population_dict %&gt;% as_tibble()

population[&#39;California&#39;]</code></pre>
<pre><code>## # A tibble: 1 x 1
##   California
##        &lt;dbl&gt;
## 1   38332521</code></pre>
<pre class="r"><code>population %&gt;% select(California:Illinois)</code></pre>
<pre><code>## # A tibble: 1 x 3
##   California  Florida Illinois
##        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1   38332521 19552860 12882135</code></pre>
</div>
<div id="create-a-date-frame-using-an-list-2" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Create a date frame using an list 2</h3>
<pre class="r"><code>area_dict = list(
  &#39;California&#39; = 423967, 
  &#39;Florida&#39; = 170312,
  &#39;Illinois&#39; = 149995,
  &#39;New York&#39; = 141297,
  &#39;Texas&#39; = 695662
  )
area_dict %&gt;% as_tibble() -&gt; area

area</code></pre>
<pre><code>## # A tibble: 1 x 5
##   California Florida Illinois `New York`  Texas
##        &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1     423967  170312   149995     141297 695662</code></pre>
</div>
<div id="subsetting-an-data-frame-using-join-or-cbind" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Subsetting an data frame using join or cbind</h3>
<p>The tidy way doesn`t support indexes so we can tidy our data.</p>
<pre class="r"><code>tidy_area &lt;- area %&gt;% gather(key = &quot;state&quot;, value = &quot;area&quot;)
tidy_state &lt;- population %&gt;% gather(key = &quot;state&quot;, value = &quot;population&quot;)</code></pre>
<pre class="r"><code>tidy_area</code></pre>
<pre><code>## # A tibble: 5 x 2
##   state        area
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 California 423967
## 2 Florida    170312
## 3 Illinois   149995
## 4 New York   141297
## 5 Texas      695662</code></pre>
<pre class="r"><code>tidy_state</code></pre>
<pre><code>## # A tibble: 5 x 2
##   state      population
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 California   38332521
## 2 Florida      19552860
## 3 Illinois     12882135
## 4 New York     19651127
## 5 Texas        26448193</code></pre>
<pre class="r"><code>tidy_area %&gt;% left_join(tidy_state)</code></pre>
<pre><code>## Joining, by = &quot;state&quot;</code></pre>
<pre><code>## # A tibble: 5 x 3
##   state        area population
##   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1 California 423967   38332521
## 2 Florida    170312   19552860
## 3 Illinois   149995   12882135
## 4 New York   141297   19651127
## 5 Texas      695662   26448193</code></pre>
<pre class="r"><code>tidy_merge &lt;- cbind(tidy_area,tidy_state[,-1])

states &lt;- tidy_merge</code></pre>
</div>
<div id="some-info-on-our-data-frame" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Some info on our data frame</h3>
<pre class="r"><code>class(tidy_merge)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code>class(tidy_merge$population)</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="r"><code>class(list(tidy_merge[&quot;population&quot;]))</code></pre>
<pre><code>## [1] &quot;list&quot;</code></pre>
<pre class="r"><code>states %&gt;% dim()</code></pre>
<pre><code>## [1] 5 3</code></pre>
<pre class="r"><code>states %&gt;% str()</code></pre>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  3 variables:
##  $ state     : chr  &quot;California&quot; &quot;Florida&quot; &quot;Illinois&quot; &quot;New York&quot; ...
##  $ area      : num  423967 170312 149995 141297 695662
##  $ population: num  38332521 19552860 12882135 19651127 26448193</code></pre>
<pre class="r"><code>states %&gt;% glimpse()</code></pre>
<pre><code>## Observations: 5
## Variables: 3
## $ state      &lt;chr&gt; &quot;California&quot;, &quot;Florida&quot;, &quot;Illinois&quot;, &quot;New York&quot;, &quot;T...
## $ area       &lt;dbl&gt; 423967, 170312, 149995, 141297, 695662
## $ population &lt;dbl&gt; 38332521, 19552860, 12882135, 19651127, 26448193</code></pre>
<pre class="r"><code>states[[&quot;Estado&quot;]]</code></pre>
<pre><code>## NULL</code></pre>
<pre class="r"><code>states %&gt;% colnames() %&gt;% tail(-1)</code></pre>
<pre><code>## [1] &quot;area&quot;       &quot;population&quot;</code></pre>
<pre class="r"><code>states$area</code></pre>
<pre><code>## [1] 423967 170312 149995 141297 695662</code></pre>
</div>
<div id="creating-new-columns-using-mutate-and-basic-r" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Creating new columns using mutate and basic R</h3>
<pre class="r"><code>states$density &lt;-  states$population / states$area
states</code></pre>
<pre><code>##        state   area population   density
## 1 California 423967   38332521  90.41393
## 2    Florida 170312   19552860 114.80612
## 3   Illinois 149995   12882135  85.88376
## 4   New York 141297   19651127 139.07675
## 5      Texas 695662   26448193  38.01874</code></pre>
<pre class="r"><code># or
states$density &lt;-  states[[&quot;population&quot;]] / states[[&quot;area&quot;]]
states</code></pre>
<pre><code>##        state   area population   density
## 1 California 423967   38332521  90.41393
## 2    Florida 170312   19552860 114.80612
## 3   Illinois 149995   12882135  85.88376
## 4   New York 141297   19651127 139.07675
## 5      Texas 695662   26448193  38.01874</code></pre>
<pre class="r"><code>#or
states %&gt;% 
  mutate(density = population / area)</code></pre>
<pre><code>##        state   area population   density
## 1 California 423967   38332521  90.41393
## 2    Florida 170312   19552860 114.80612
## 3   Illinois 149995   12882135  85.88376
## 4   New York 141297   19651127 139.07675
## 5      Texas 695662   26448193  38.01874</code></pre>
</div>
<div id="ordering-an-data-frame-using-the-tidy-way-arrange-or-order." class="section level3">
<h3><span class="header-section-number">3.2.6</span> Ordering an data frame using the tidy way arrange or order.</h3>
<p>You can also use -c() or desc() sometimes -c() can give strange results.</p>
<pre class="r"><code>states %&gt;% arrange(desc(population))</code></pre>
<pre><code>##        state   area population   density
## 1 California 423967   38332521  90.41393
## 2      Texas 695662   26448193  38.01874
## 3   New York 141297   19651127 139.07675
## 4    Florida 170312   19552860 114.80612
## 5   Illinois 149995   12882135  85.88376</code></pre>
<pre class="r"><code>states[order(states$area),]</code></pre>
<pre><code>##        state   area population   density
## 4   New York 141297   19651127 139.07675
## 3   Illinois 149995   12882135  85.88376
## 2    Florida 170312   19552860 114.80612
## 1 California 423967   38332521  90.41393
## 5      Texas 695662   26448193  38.01874</code></pre>
<pre class="r"><code># Mix and match all three formas
states %&gt;% arrange(-c(density),desc(population,area),state)</code></pre>
<pre><code>##        state   area population   density
## 1   New York 141297   19651127 139.07675
## 2    Florida 170312   19552860 114.80612
## 3 California 423967   38332521  90.41393
## 4   Illinois 149995   12882135  85.88376
## 5      Texas 695662   26448193  38.01874</code></pre>
</div>
<div id="filtering-rows-using-standard-r-code-or-filter." class="section level3">
<h3><span class="header-section-number">3.2.7</span> Filtering rows using standard R code or filter.</h3>
<pre class="r"><code>states[1:3,]</code></pre>
<pre><code>##        state   area population   density
## 1 California 423967   38332521  90.41393
## 2    Florida 170312   19552860 114.80612
## 3   Illinois 149995   12882135  85.88376</code></pre>
<pre class="r"><code>data_pop &lt;- states[states$population &gt; 19552860 &amp; states$area &gt; 423967,]
data_pop</code></pre>
<pre><code>##   state   area population  density
## 5 Texas 695662   26448193 38.01874</code></pre>
<pre class="r"><code>states %&gt;% 
  filter(population &gt; 19552860 &amp; area &gt; 423967)</code></pre>
<pre><code>##   state   area population  density
## 1 Texas 695662   26448193 38.01874</code></pre>
<p>you can mix and match filter for rows and select for columns.</p>
<pre class="r"><code>states %&gt;% 
  filter(density &gt; 100)</code></pre>
<pre><code>##      state   area population  density
## 1  Florida 170312   19552860 114.8061
## 2 New York 141297   19651127 139.0767</code></pre>
<pre class="r"><code>states %&gt;%
  filter(density &gt; 100) %&gt;% 
  select(population,density)</code></pre>
<pre><code>##   population  density
## 1   19552860 114.8061
## 2   19651127 139.0767</code></pre>
<pre class="r"><code>states[1,4]</code></pre>
<pre><code>## [1] 90.41393</code></pre>
</div>
</div>
<div id="real-case" class="section level2">
<h2><span class="header-section-number">3.3</span> Real Case</h2>
<div id="two-way-of-importing-an-csv" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Two way of importing an csv</h3>
<pre class="r"><code>sales &lt;- read_csv(&#39;data/2019-03-23-exploratory-data-analysis-basic-pandas-and-dplyr/UKretail.csv&#39;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   InvoiceNo = col_character(),
##   StockCode = col_character(),
##   Description = col_character(),
##   Quantity = col_double(),
##   InvoiceDate = col_datetime(format = &quot;&quot;),
##   UnitPrice = col_double(),
##   CustomerID = col_double(),
##   Country = col_character()
## )</code></pre>
<pre class="r"><code>sales &lt;- read.csv(&#39;data/2019-03-23-exploratory-data-analysis-basic-pandas-and-dplyr/UKretail.csv&#39;)</code></pre>
<p>If you think this looks like an ugly path and a was of space I would agree we
can fix this by using one of my favorite thinks from python the ""key I avoided.<br />
I am now using it on the python part to show the power of neat line.</p>
<pre class="python"><code>path_file = &#39;data/\
2019-03-23-exploratory-data-analysis-basic-pandas-and-dplyr/\
UKretail.csv&#39; </code></pre>
<pre class="r"><code>sales &lt;- read_csv(py$path_file)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   InvoiceNo = col_character(),
##   StockCode = col_character(),
##   Description = col_character(),
##   Quantity = col_double(),
##   InvoiceDate = col_datetime(format = &quot;&quot;),
##   UnitPrice = col_double(),
##   CustomerID = col_double(),
##   Country = col_character()
## )</code></pre>
<p>Finally our first usefull python to r functionality!</p>
</div>
<div id="lets-look-at-our-data" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Let’s look at our data</h3>
<pre class="r"><code>sales %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 8
##   InvoiceNo StockCode Description Quantity InvoiceDate         UnitPrice
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;
## 1 536365    22752     SET 7 BABU~        2 2010-12-01 08:26:02      7.65
## 2 536365    71053     WHITE META~        6 2010-12-01 08:26:02      3.39
## 3 536365    84029G    KNITTED UN~        6 2010-12-01 08:26:02      3.39
## 4 536365    85123A    WHITE HANG~        6 2010-12-01 08:26:02      2.55
## 5 536366    22633     HAND WARME~        6 2010-12-01 08:28:02      1.85
## 6 536367    21754     HOME BUILD~        3 2010-12-01 08:33:59      5.95
## # ... with 2 more variables: CustomerID &lt;dbl&gt;, Country &lt;chr&gt;</code></pre>
<pre class="r"><code>sales %&gt;% tail(3)</code></pre>
<pre><code>## # A tibble: 3 x 8
##   InvoiceNo StockCode Description Quantity InvoiceDate         UnitPrice
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;
## 1 581587    22899     CHILDREN&#39;S~        6 2011-12-09 12:49:59      2.1 
## 2 581587    23254     CHILDRENS ~        4 2011-12-09 12:49:59      4.15
## 3 581587    23256     CHILDRENS ~        4 2011-12-09 12:49:59      4.15
## # ... with 2 more variables: CustomerID &lt;dbl&gt;, Country &lt;chr&gt;</code></pre>
</div>
<div id="r_types_columns" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Types of columns r</h3>
<p>If you payed attention read_ tries to inform what conversion was used in each column that is specially cool because base R tends to create unesceassary factor whne in fact you are working with strings, but know you can choose between three different implementation of the read command.</p>
<p>A cool thing about tibbles is that they are in fact still data.frame.</p>
<pre class="r"><code>sales %&gt;% class()</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<p>Pay attention to the R difference between “[[” and “[” if you recall this is the “opposite” of the python behavior.<br />
Jump to <a href="#py_types_columns">python implementation</a>.</p>
<pre class="r"><code>sales[[&quot;CustomerID&quot;]] %&gt;% class()</code></pre>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<pre class="r"><code>sales[&quot;CustomerID&quot;] %&gt;% class()</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div id="basic-description-real-data-using-glimpse-and-str" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Basic Description real data using Glimpse and str</h3>
<pre class="r"><code>sales %&gt;% dim()</code></pre>
<pre><code>## [1] 325145      8</code></pre>
<pre class="r"><code>sales %&gt;% colnames()</code></pre>
<pre><code>## [1] &quot;InvoiceNo&quot;   &quot;StockCode&quot;   &quot;Description&quot; &quot;Quantity&quot;    &quot;InvoiceDate&quot;
## [6] &quot;UnitPrice&quot;   &quot;CustomerID&quot;  &quot;Country&quot;</code></pre>
<pre class="r"><code>sales %&gt;% glimpse()</code></pre>
<pre><code>## Observations: 325,145
## Variables: 8
## $ InvoiceNo   &lt;chr&gt; &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;, &quot;536365&quot;, &quot;536366&quot;, ...
## $ StockCode   &lt;chr&gt; &quot;22752&quot;, &quot;71053&quot;, &quot;84029G&quot;, &quot;85123A&quot;, &quot;22633&quot;, &quot;21...
## $ Description &lt;chr&gt; &quot;SET 7 BABUSHKA NESTING BOXES&quot;, &quot;WHITE METAL LANTE...
## $ Quantity    &lt;dbl&gt; 2, 6, 6, 6, 6, 3, 3, 4, 6, 6, 6, 8, 4, 3, 3, 48, 2...
## $ InvoiceDate &lt;dttm&gt; 2010-12-01 08:26:02, 2010-12-01 08:26:02, 2010-12...
## $ UnitPrice   &lt;dbl&gt; 7.65, 3.39, 3.39, 2.55, 1.85, 5.95, 5.95, 7.95, 1....
## $ CustomerID  &lt;dbl&gt; 17850, 17850, 17850, 17850, 17850, 13047, 13047, 1...
## $ Country     &lt;chr&gt; &quot;United Kingdom&quot;, &quot;United Kingdom&quot;, &quot;United Kingdo...</code></pre>
<pre class="r"><code>sales %&gt;% str()</code></pre>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 325145 obs. of  8 variables:
##  $ InvoiceNo  : chr  &quot;536365&quot; &quot;536365&quot; &quot;536365&quot; &quot;536365&quot; ...
##  $ StockCode  : chr  &quot;22752&quot; &quot;71053&quot; &quot;84029G&quot; &quot;85123A&quot; ...
##  $ Description: chr  &quot;SET 7 BABUSHKA NESTING BOXES&quot; &quot;WHITE METAL LANTERN&quot; &quot;KNITTED UNION FLAG HOT WATER BOTTLE&quot; &quot;WHITE HANGING HEART T-LIGHT HOLDER&quot; ...
##  $ Quantity   : num  2 6 6 6 6 3 3 4 6 6 ...
##  $ InvoiceDate: POSIXct, format: &quot;2010-12-01 08:26:02&quot; &quot;2010-12-01 08:26:02&quot; ...
##  $ UnitPrice  : num  7.65 3.39 3.39 2.55 1.85 5.95 5.95 7.95 1.65 2.1 ...
##  $ CustomerID : num  17850 17850 17850 17850 17850 ...
##  $ Country    : chr  &quot;United Kingdom&quot; &quot;United Kingdom&quot; &quot;United Kingdom&quot; &quot;United Kingdom&quot; ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   InvoiceNo = col_character(),
##   ..   StockCode = col_character(),
##   ..   Description = col_character(),
##   ..   Quantity = col_double(),
##   ..   InvoiceDate = col_datetime(format = &quot;&quot;),
##   ..   UnitPrice = col_double(),
##   ..   CustomerID = col_double(),
##   ..   Country = col_character()
##   .. )</code></pre>
<pre class="r"><code>sales %&gt;% summary()</code></pre>
<pre><code>##   InvoiceNo          StockCode         Description       
##  Length:325145      Length:325145      Length:325145     
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##                                                          
##                                                          
##                                                          
##                                                          
##     Quantity          InvoiceDate                    UnitPrice        
##  Min.   :-80995.00   Min.   :2010-12-01 08:26:02   Min.   :-11062.06  
##  1st Qu.:     1.00   1st Qu.:2011-03-28 12:13:02   1st Qu.:     1.25  
##  Median :     3.00   Median :2011-07-20 10:50:59   Median :     2.08  
##  Mean   :     9.27   Mean   :2011-07-04 14:11:43   Mean   :     4.85  
##  3rd Qu.:    10.00   3rd Qu.:2011-10-19 10:47:59   3rd Qu.:     4.13  
##  Max.   : 12540.00   Max.   :2011-12-09 12:49:59   Max.   : 38970.00  
##                                                                       
##    CustomerID      Country         
##  Min.   :12347   Length:325145     
##  1st Qu.:13959   Class :character  
##  Median :15150   Mode  :character  
##  Mean   :15289                     
##  3rd Qu.:16793                     
##  Max.   :18287                     
##  NA&#39;s   :80991</code></pre>
<p>If you agree with me that summary sucks on a data.frame object I am glad to show skimr, also if you don’t like summary behaviour on model outputs <a href="https://cran.r-project.org/web/packages/broom/index.html">broom</a> is there to save you, I will talk more about when I make an <a href="https://scikit-learn.org/stable/">scikit-learn</a> and <a href="https://topepo.github.io/caret/">caret</a> + <a href="https://www.tidyverse.org/articles/2018/08/tidymodels-0-0-1/">tidymodels</a> post.</p>
</div>
<div id="subsetting-data-with-select-or-base-r" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Subsetting Data with select or base R</h3>
<pre class="r"><code>sales[1:4,]</code></pre>
<pre><code>## # A tibble: 4 x 8
##   InvoiceNo StockCode Description Quantity InvoiceDate         UnitPrice
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;
## 1 536365    22752     SET 7 BABU~        2 2010-12-01 08:26:02      7.65
## 2 536365    71053     WHITE META~        6 2010-12-01 08:26:02      3.39
## 3 536365    84029G    KNITTED UN~        6 2010-12-01 08:26:02      3.39
## 4 536365    85123A    WHITE HANG~        6 2010-12-01 08:26:02      2.55
## # ... with 2 more variables: CustomerID &lt;dbl&gt;, Country &lt;chr&gt;</code></pre>
<pre class="r"><code>sales$CustomerID %&gt;% head()</code></pre>
<pre><code>## [1] 17850 17850 17850 17850 17850 13047</code></pre>
<pre class="r"><code>sales[[&quot;CustomerID&quot;]] %&gt;% head()</code></pre>
<pre><code>## [1] 17850 17850 17850 17850 17850 13047</code></pre>
<pre class="r"><code>sales[,3] %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 1
##   Description                        
##   &lt;chr&gt;                              
## 1 SET 7 BABUSHKA NESTING BOXES       
## 2 WHITE METAL LANTERN                
## 3 KNITTED UNION FLAG HOT WATER BOTTLE
## 4 WHITE HANGING HEART T-LIGHT HOLDER 
## 5 HAND WARMER UNION JACK             
## 6 HOME BUILDING BLOCK WORD</code></pre>
<pre class="r"><code>sales[1:5,3]</code></pre>
<pre><code>## # A tibble: 5 x 1
##   Description                        
##   &lt;chr&gt;                              
## 1 SET 7 BABUSHKA NESTING BOXES       
## 2 WHITE METAL LANTERN                
## 3 KNITTED UNION FLAG HOT WATER BOTTLE
## 4 WHITE HANGING HEART T-LIGHT HOLDER 
## 5 HAND WARMER UNION JACK</code></pre>
<pre class="r"><code>sales$Revenue2 &lt;- sales$Quantity * sales$UnitPrice

sales[[&quot;Revenue3&quot;]] &lt;- sales[[&quot;Quantity&quot;]] * sales[[&quot;UnitPrice&quot;]]

# () show created objects 
# Strange behavior right here 6 rowns on head()
(sales &lt;- sales %&gt;% mutate(Revenue = Quantity * UnitPrice)) %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 11
##   InvoiceNo StockCode Description Quantity InvoiceDate         UnitPrice
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;dttm&gt;                  &lt;dbl&gt;
## 1 536365    22752     SET 7 BABU~        2 2010-12-01 08:26:02      7.65
## 2 536365    71053     WHITE META~        6 2010-12-01 08:26:02      3.39
## 3 536365    84029G    KNITTED UN~        6 2010-12-01 08:26:02      3.39
## 4 536365    85123A    WHITE HANG~        6 2010-12-01 08:26:02      2.55
## 5 536366    22633     HAND WARME~        6 2010-12-01 08:28:02      1.85
## 6 536367    21754     HOME BUILD~        3 2010-12-01 08:33:59      5.95
## # ... with 5 more variables: CustomerID &lt;dbl&gt;, Country &lt;chr&gt;,
## #   Revenue2 &lt;dbl&gt;, Revenue3 &lt;dbl&gt;, Revenue &lt;dbl&gt;</code></pre>
<pre class="r"><code>sum(sales$Revenue == sales$Revenue2)/nrow(sales)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>sum(sales$Revenue == sales$Revenue3)/nrow(sales)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>sum(sales$Revenue2 == sales$Revenue3)/nrow(sales)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code># If there were any differences between our columns the sum would return &lt;1    </code></pre>
</div>
<div id="creating-a-new-smaller-data-frame-using-transmute-and-base" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Creating a new smaller data frame using transmute and base</h3>
<pre class="r"><code>raw_sales &lt;- sales %&gt;% select(Quantity, UnitPrice, Revenue)

raw_sales %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 3
##   Quantity UnitPrice Revenue
##      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1        2      7.65    15.3
## 2        6      3.39    20.3
## 3        6      3.39    20.3
## 4        6      2.55    15.3
## 5        6      1.85    11.1
## 6        3      5.95    17.8</code></pre>
<pre class="r"><code>raw_sales %&gt;% glimpse()</code></pre>
<pre><code>## Observations: 325,145
## Variables: 3
## $ Quantity  &lt;dbl&gt; 2, 6, 6, 6, 6, 3, 3, 4, 6, 6, 6, 8, 4, 3, 3, 48, 24,...
## $ UnitPrice &lt;dbl&gt; 7.65, 3.39, 3.39, 2.55, 1.85, 5.95, 5.95, 7.95, 1.65...
## $ Revenue   &lt;dbl&gt; 15.30, 20.34, 20.34, 15.30, 11.10, 17.85, 17.85, 31....</code></pre>
<pre class="r"><code>raw_sales %&gt;% skimr::skim()</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 325145 
##  n variables: 3 
## 
## -- Variable type:numeric ----------------------------------------------------------------------
##   variable missing complete      n  mean     sd         p0  p25  p50   p75
##   Quantity       0   325145 325145  9.27 154.39  -80995    1    3    10   
##    Revenue       0   325145 325145 17.43 331.85 -168469.6  3.4  9.48 17.4 
##  UnitPrice       0   325145 325145  4.85 116.83  -11062.06 1.25 2.08  4.13
##   p100     hist
##  12540 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;
##  38970 &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;
##  38970 &lt;U+2581&gt;&lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;</code></pre>
</div>
<div id="ploting-with-ggplot" class="section level3">
<h3><span class="header-section-number">3.3.7</span> Ploting with ggplot</h3>
<pre class="r"><code>sales %&gt;% ggplot() +
  aes(x = InvoiceDate, y = Revenue) +
  geom_line()</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-68-1.png" width="672" /></p>
</div>
<div id="filtering_r" class="section level3">
<h3><span class="header-section-number">3.3.8</span> Filtering and replace data</h3>
<p>Here I really couldn`t figure out an easy way to filter using this
cancel tricky that works in <a href="#filtering_py">python</a>.</p>
<pre class="r"><code>cancels = sales$Revenue &lt; 0
cancels %&gt;% nrow()</code></pre>
<pre><code>## NULL</code></pre>
<pre class="r"><code>invert_func &lt;- function(cancel){
  ifelse(cancel == 1,
         0,
         1)
  }


sales2 = sales[invert_func(cancels),]

sales2 %&gt;% dim()</code></pre>
<pre><code>## [1] 319557     11</code></pre>
<p>I really prefer the tidy way also.</p>
<pre class="r"><code>sales &lt;- sales %&gt;% filter(Revenue &gt; 0)</code></pre>
</div>
<div id="groupby-example-in-tidyverse" class="section level3">
<h3><span class="header-section-number">3.3.9</span> Groupby example in tidyverse</h3>
<p>I prefer the tidy way here as well.</p>
<pre class="r"><code>CountryGroups &lt;- sales %&gt;% 
  group_by(Country) %&gt;% 
  summarise(sum_revenue = sum(Revenue),
            number_cases = n()) %&gt;% 
  arrange(-sum_revenue)

CountryGroups</code></pre>
<pre><code>## # A tibble: 38 x 3
##    Country        sum_revenue number_cases
##    &lt;chr&gt;                &lt;dbl&gt;        &lt;int&gt;
##  1 United Kingdom    5311080.       291129
##  2 EIRE               176305.         4788
##  3 Netherlands        165583.         1391
##  4 Germany            138778.         5465
##  5 France             127194.         5025
##  6 Australia           79198.          726
##  7 Spain               36117.         1420
##  8 Switzerland         34315.         1169
##  9 Belgium             24015.         1191
## 10 Norway              23182.          658
## # ... with 28 more rows</code></pre>
<pre class="r"><code>skimr::skim(sales)</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 318036 
##  n variables: 11 
## 
## -- Variable type:character --------------------------------------------------------------------
##     variable missing complete      n min max empty n_unique
##      Country       0   318036 318036   3  20     0       38
##  Description       0   318036 318036   6  35     0     3926
##    InvoiceNo       0   318036 318036   6   7     0    19107
##    StockCode       0   318036 318036   1  12     0     3835
## 
## -- Variable type:numeric ----------------------------------------------------------------------
##    variable missing complete      n     mean      sd        p0      p25
##  CustomerID   79261   238775 318036 15295.34 1713.1  12347     13969   
##    Quantity       0   318036 318036    10.25   38.3      1         1   
##     Revenue       0   318036 318036    19.78  104.17     0.001     3.75
##    Revenue2       0   318036 318036    19.78  104.17     0.001     3.75
##    Revenue3       0   318036 318036    19.78  104.17     0.001     3.75
##   UnitPrice       0   318036 318036     3.96   42.53     0.001     1.25
##       p50      p75     p100     hist
##  15157    16800    18287    &lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2586&gt;&lt;U+2586&gt;&lt;U+2587&gt;
##      3       10     4800    &lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;
##      9.9     17.7  38970    &lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;
##      9.9     17.7  38970    &lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;
##      9.9     17.7  38970    &lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;
##      2.08     4.13 13541.33 &lt;U+2587&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2581&gt;
## 
## -- Variable type:POSIXct ----------------------------------------------------------------------
##     variable missing complete      n        min        max     median
##  InvoiceDate       0   318036 318036 2010-12-01 2011-12-09 2011-07-20
##  n_unique
##     17750</code></pre>
</div>
<div id="ploting-an-histogram-using-ggplot2" class="section level3">
<h3><span class="header-section-number">3.3.10</span> Ploting an histogram using ggplot2</h3>
<pre class="r"><code>sales %&gt;%
  filter(CustomerID == 17850) %&gt;% 
  ggplot() +
  aes(Revenue) +
  geom_histogram(bins = 20)</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-73-1.png" width="672" /></p>
<p>Another example.</p>
<pre class="r"><code>sales %&gt;%
  filter(StockCode == 71053) %&gt;% 
  ggplot() +
  aes(Revenue) +
  geom_histogram(bins = 20)</code></pre>
<p><img src="/post/2019/2019-03/2019-03-23/1/exploratory_data1_files/figure-html/exploratory_data1-74-1.png" width="672" /></p>
</div>
<div id="missing_values_r" class="section level3">
<h3><span class="header-section-number">3.3.11</span> Handling Missing values in R</h3>
<p>Ok I got hand this one to <a href="#missing_values_py">python</a>.</p>
<pre class="r"><code>sales2$CustomerID %&gt;% 
  table(useNA = &#39;always&#39;) %&gt;%
  sort(decreasing = TRUE) %&gt;%
  head(3)</code></pre>
<pre><code>## .
##  17850   &lt;NA&gt; 
## 319557      0</code></pre>
<p>This is just not simple enough luckly we can create functions for our afflictions, plus this is replacement as an side effect which sucks.</p>
<pre class="r"><code>#sales[sales[[&quot;CustomerID&quot;]] %&gt;% is.na(),&quot;CustomerID&quot;] &lt;- 0</code></pre>
<p>This is an way better tidy way.</p>
<pre class="r"><code># sales %&gt;% mutate_if(is.numeric, funs(replace(., is.na(.), 0)))
sales2 &lt;- sales %&gt;% mutate_at(vars(CustomerID),
                    list(
                      ~replace(.,
                              is.na(.), # function that check condition (na)
                              0) # value to replace could be mean(.,na.rm = T)
                      )
                    )</code></pre>
<p>Using an stronger method like mice even with an <a href="https://cran.r-project.org/web/packages/micemd/index.html">amazing multicore package</a> takes too long for an blogpost, plus I really don’t think there should be an model for CustomerID here is some workflow if you need to split your data.</p>
<pre class="r"><code>non_character_sales &lt;- sales %&gt;%
  select_if(function(col)
    is.numeric(col) |
      is.factor(col))

# or my favorite
select_cases &lt;- function(col) {
  is.numeric(col) |
  is.factor(col)
}

non_character_sales &lt;- sales %&gt;% select_if(select_cases)

non_character_sales %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 6
##   Quantity UnitPrice CustomerID Revenue2 Revenue3 Revenue
##      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1        2      7.65      17850     15.3     15.3    15.3
## 2        6      3.39      17850     20.3     20.3    20.3
## 3        6      3.39      17850     20.3     20.3    20.3
## 4        6      2.55      17850     15.3     15.3    15.3
## 5        6      1.85      17850     11.1     11.1    11.1
## 6        3      5.95      13047     17.8     17.8    17.8</code></pre>
<pre class="r"><code>character_sales &lt;- sales %&gt;% select_if(negate(is.numeric))

character_sales %&gt;% head()</code></pre>
<pre><code>## # A tibble: 6 x 5
##   InvoiceNo StockCode Description            InvoiceDate         Country   
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;                  &lt;dttm&gt;              &lt;chr&gt;     
## 1 536365    22752     SET 7 BABUSHKA NESTIN~ 2010-12-01 08:26:02 United Ki~
## 2 536365    71053     WHITE METAL LANTERN    2010-12-01 08:26:02 United Ki~
## 3 536365    84029G    KNITTED UNION FLAG HO~ 2010-12-01 08:26:02 United Ki~
## 4 536365    85123A    WHITE HANGING HEART T~ 2010-12-01 08:26:02 United Ki~
## 5 536366    22633     HAND WARMER UNION JACK 2010-12-01 08:28:02 United Ki~
## 6 536367    21754     HOME BUILDING BLOCK W~ 2010-12-01 08:33:59 United Ki~</code></pre>
<pre class="r"><code>sales3 &lt;- cbind(character_sales,non_character_sales)

# if you need the same order

sales3 &lt;- sales3 %&gt;% select(names(sales)) </code></pre>
</div>
<div id="replacing-names-with-an-case-when-aproach" class="section level3">
<h3><span class="header-section-number">3.3.12</span> Replacing names with an case when aproach</h3>
<p>Don’t mix and match numbers and characters else this will cause an error.</p>
<pre class="r"><code>replace_function &lt;-  function(country) {
  case_when(
  country == &#39;United Kingdom&#39; ~ &quot;1&quot;,
  country == &#39;Netherlands&#39; ~ &quot;2&quot;,
  country == &#39;Germany&#39; ~ &quot;3&quot;,
  country == &#39;France&#39; ~ &quot;4&quot;,
  country == &#39;USA&#39; ~ &quot;5&quot;,
  TRUE    ~ country
)
  }</code></pre>
<pre class="r"><code>sales3 &lt;- sales3 %&gt;% mutate(new = replace_function(Country))

sales3 %&gt;% head()</code></pre>
<pre><code>##   InvoiceNo StockCode                         Description Quantity
## 1    536365     22752        SET 7 BABUSHKA NESTING BOXES        2
## 2    536365     71053                 WHITE METAL LANTERN        6
## 3    536365    84029G KNITTED UNION FLAG HOT WATER BOTTLE        6
## 4    536365    85123A  WHITE HANGING HEART T-LIGHT HOLDER        6
## 5    536366     22633              HAND WARMER UNION JACK        6
## 6    536367     21754            HOME BUILDING BLOCK WORD        3
##           InvoiceDate UnitPrice CustomerID        Country Revenue2
## 1 2010-12-01 08:26:02      7.65      17850 United Kingdom    15.30
## 2 2010-12-01 08:26:02      3.39      17850 United Kingdom    20.34
## 3 2010-12-01 08:26:02      3.39      17850 United Kingdom    20.34
## 4 2010-12-01 08:26:02      2.55      17850 United Kingdom    15.30
## 5 2010-12-01 08:28:02      1.85      17850 United Kingdom    11.10
## 6 2010-12-01 08:33:59      5.95      13047 United Kingdom    17.85
##   Revenue3 Revenue new
## 1    15.30   15.30   1
## 2    20.34   20.34   1
## 3    20.34   20.34   1
## 4    15.30   15.30   1
## 5    11.10   11.10   1
## 6    17.85   17.85   1</code></pre>
<p>Two ways of solving our case_count deficiency.</p>
<pre class="r"><code>value_counts &lt;- function(column, useNA = &#39;always&#39;, decreasing = TRUE) {
  column %&gt;% 
  table(useNA = useNA) %&gt;%
  sort(decreasing = decreasing)
}

sales3[[&quot;new&quot;]] %&gt;% value_counts() %&gt;% head(7)</code></pre>
<pre><code>## .
##       1       3       4    EIRE   Spain       2 Belgium 
##  291129    5465    5025    4788    1420    1391    1191</code></pre>
</div>
</div>
<div id="passing-objects-to-python" class="section level2">
<h2><span class="header-section-number">3.4</span> Passing Objects to Python</h2>
<p>Simple example.</p>
<pre class="python"><code>sales2 = r.sales2
type(sales2)</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</code></pre>
<p>We can solve our value_counts problem by simply stealing from python then returning the results to r.</p>
<pre class="python"><code>sales3_solution = \
r.\
sales3.\
new.\
value_counts().\
nlargest(7)</code></pre>
<p>If we want to continue working in r after the steal.</p>
<pre class="r"><code>sales3_solution = py$sales3_solution
sales3_solution</code></pre>
<pre><code>##       1       3       4    EIRE   Spain       2 Belgium 
##  291129    5465    5025    4788    1420    1391    1191</code></pre>
<p><img src="https://media.giphy.com/media/7zW0iLn9SKYao6f8sE/giphy.gif" /></p>
</div>
</div>
