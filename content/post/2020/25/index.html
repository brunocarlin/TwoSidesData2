
<div id="TOC">
<ul>
<li><a href="#second-post">Second Post</a><ul>
<li><a href="#objectives">Objectives</a></li>
<li><a href="#define-the-variables-used-in-the-conclusion">Define the variables used in the conclusion</a></li>
<li><a href="#using-masks-or-other-methods-to-filter-the-data">Using masks or other methods to filter the data</a></li>
<li><a href="#visualizing-the-hypothesis">Visualizing the hypothesis</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#before-we-start">Before we start</a><ul>
<li><a href="#reservations">Reservations</a></li>
<li><a href="#data-dictionary">Data Dictionary</a></li>
</ul></li>
</ul></li>
<li><a href="#python">Python</a><ul>
<li><a href="#importing-the-dataset-from-part-1">Importing the dataset from part 1</a></li>
</ul></li>
</ul>
</div>

<p>I am currently doing exercises from <a href="https://github.com/sn3fru/datascience_course">digital house brasil</a></p>
<p>Let’s see what version of python this env is running.</p>
<pre class="r"><code>reticulate::py_config()</code></pre>
<pre><code>## python:         /home/bruno-carlin/Documents/GIthub/TwoSidesData2/.venv/bin/python
## libpython:      /opt/python/3.7/lib/libpython3.7m.so
## pythonhome:     /opt/python/3.7:/opt/python/3.7
## virtualenv:     /home/bruno-carlin/Documents/GIthub/TwoSidesData2/.venv/bin/activate_this.py
## version:        3.7.4 (default, Aug 13 2019, 20:35:49)  [GCC 7.3.0]
## numpy:          /home/bruno-carlin/Documents/GIthub/TwoSidesData2/.venv/lib/python3.7/site-packages/numpy
## numpy_version:  1.18.1
## 
## NOTE: Python version was forced by use_python function</code></pre>
<pre class="python"><code>import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd
import os</code></pre>
<div id="second-post" class="section level1">
<h1>Second Post</h1>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
</div>
<div id="define-the-variables-used-in-the-conclusion" class="section level2">
<h2>Define the variables used in the conclusion</h2>
<p>In our case, we choose to use <a href="#python_hypothesis_testing">salary ~ sex,region</a> region was added to test whether <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s paradox</a> was at play.</p>
</div>
<div id="using-masks-or-other-methods-to-filter-the-data" class="section level2">
<h2>Using masks or other methods to filter the data</h2>
<p>This objective was mostly done using the groupby function.</p>
</div>
<div id="visualizing-the-hypothesis" class="section level2">
<h2>Visualizing the hypothesis</h2>
<p><a href="#python_plot_histograms">We were advised to use two histograms combined to get a preview of our answer.</a></p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Comment on our findings.</p>
</div>
<div id="before-we-start" class="section level2">
<h2>Before we start</h2>
<div id="reservations" class="section level3">
<h3>Reservations</h3>
<p>This is an exercise where we were supposed to ask a relevant question using the data from the IBGE(Brazil’s main data collector) database of 1970.</p>
<p>Our group decided to ask whether women received less than man, we expanded the analysis hoping to avoid the Simpson’s paradox.</p>
<p>This is just an basic inference, and it’s results are therefore only used for studying purposes I don’t believe any finding would be relevant using just this approach but some basic operations can be used in a more impact full work.</p>
</div>
<div id="data-dictionary" class="section level3">
<h3>Data Dictionary</h3>
<p>We got a Data Dictionary that will be very useful for our Analysis, it contains all the required information about the encoding of the columns and the intended format that the folks at STATA desired.</p>
<details>
<summary>Portuguese</summary>
<p>
<p>Descrição do Registro de Indivíduos nos EUA.</p>
<p>Dataset do software STATA (pago), vamos abri-lo com o pandas e transforma-lo em DataFrame.</p>
<p>Variável 1 – CHAVE DO INDIVÍDUO ? Formato N - Numérico ? Tamanho 11 dígitos (11 bytes) ? Descrição Sumária Identifica unicamente o indivíduo na amostra.</p>
<p>Variável 2 - IDADE CALCULADA EM ANOS ? Formato N - Numérico ? Tamanho 3 dígitos (3 bytes) ? Descrição Sumária Identifica a idade do morador em anos completos.</p>
<p>Variável 3 – SEXO ? Formato N - Numérico ? Tamanho 1 dígito (1 byte) ? Quantidade de Categorias 3 ? Descrição Sumária Identifica o sexo do morador. Categorias (1) homem, (2) mulher e (3) gestante.</p>
<p>Variável 4 – ANOS DE ESTUDO ? Formato N - Numérico ? Tamanho 2 dígitos (2 bytes) ? Quantidade de Categorias 11 ? Descrição Sumária Identifica o número de anos de estudo do morador. Categorias (05) Cinco ou menos, (06) Seis, (07) Sete, (08) Oito, (09) Nove, (10) Dez, (11) Onze, (12) Doze, (13) Treze, (14) Quatorze, (15) Quinze ou mais.</p>
<p>Variável 5 – COR OU RAÇA ? Formato N - Numérico ? Tamanho 2 dígitos (2 bytes) ? Quantidade de Categorias 6 ? Descrição Sumária Identifica a Cor ou Raça declarada pelo morador. Categorias (01) Branca, (02) Preta, (03) Amarela, (04) Parda, (05) Indígena e (09) Não Sabe.</p>
<p>Variável 6 – VALOR DO SALÁRIO (ANUALIZADO) ? Formato N - Numérico ? Tamanho 8 dígitos (8 bytes) ? Quantidade de Decimais 2 ? Descrição Sumária Identifica o valor resultante do salário anual do indivíduo. Categorias especiais (-1) indivíduo ausente na data da pesquisa e (999999) indivíduo não quis responder.</p>
<p>Variável 7 – ESTADO CIVIL ? Formato N - Numérico ? Tamanho 1 dígito (1 byte) ? Quantidade de Categorias 2 ? Descrição Sumária Dummy que identifica o estado civil declarado pelo morador. Categorias (1) Casado, (0) não casado.</p>
<p>Variável 8 – REGIÃO GEOGRÁFICA ? Formato N - Numérico ? Tamanho 1 dígito (1 byte) ? Quantidade de Categorias 5 ? Descrição Sumária Identifica a região geográfica do morador. Categorias (1) Norte, (2) Nordeste, (3) Sudeste, (4) Sul e (5) Centro-oeste.</p>
</p>
</details>
<details>
<summary>English</summary>
<p>
<p>Description of the US Individual Registry.</p>
<p>Dataset of the STATA software (paid), we will open it with pandas and turn it into DataFrame.</p>
<p>Variable 1 - KEY OF THE INDIVIDUAL? Format N - Numeric? Size 11 digits (11 bytes)? Summary Description Uniquely identifies the individual in the sample.</p>
<p>Variable 2 - AGE CALCULATED IN YEARS? Format N - Numeric? Size 3 digits (3 bytes)? Summary Description Identifies the age of the resident in full years.</p>
<p>Variable 3 - SEX? Format N - Numeric? Size 1 digit (1 byte)? Number of Categories 3? Summary Description Identifies the gender of the resident. Categories (1) men, (2) women and (3) pregnant women.</p>
<p>Variable 4 - YEARS OF STUDY? Format N - Numeric? Size 2 digits (2 bytes)? Number of Categories 11? Summary Description Identifies the number of years of study of the resident. Categories (05) Five or less, (06) Six, (07) Seven, (08) Eight, (09) Nine, (10) Dec, (11) Eleven, (12) Twelve, (13) Thirteen, (14 ) Fourteen, (15) Fifteen or more.</p>
<p>Variable 5 - COLOR OR RACE? Format N - Numeric? Size 2 digits (2 bytes)? Number of Categories 6? Summary Description Identifies the Color or Race declared by the resident. Categories (01) White, (02) Black, (03) Yellow, (04) Brown, (05) Indigenous and (09) Don’t know.</p>
<p>Variable 6 - WAGE VALUE (ANNUALIZED)? Format N - Numeric? Size 8 digits (8 bytes)? Number of decimals 2? Summary Description Identifies the amount resulting from the individual’s annual salary. Special categories (-1) individual absent on the survey date and (999999) individual did not want to answer.</p>
<p>Variable 7 - CIVIL STATE? Format N - Numeric? Size 1 digit (1 byte)? Number of Categories 2? Summary Description Dummy that identifies the marital status declared by the resident. Categories (1) Married, (0) Not married.</p>
<p>Variable 8 - GEOGRAPHICAL REGION? Format N - Numeric? Size 1 digit (1 byte)? Number of Categories 5? Summary Description Identifies the resident’s geographic region. Categories (1) North, (2) Northeast, (3) Southeast, (4) South and (5) Midwest.</p>
</p>
</details>
</div>
</div>
</div>
<div id="python" class="section level1">
<h1>Python</h1>
<div id="importing-the-dataset-from-part-1" class="section level2">
<h2>Importing the dataset from part 1</h2>
<pre class="python"><code>df_sex_thesis =pd.read_feather(r.file_path_linux + &#39;/sex_thesis_assignment.feather&#39;)</code></pre>
<pre class="python"><code>df_sex_thesis.info()</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## RangeIndex: 65795 entries, 0 to 65794
## Data columns (total 9 columns):
## index           65795 non-null int64
## age             65795 non-null int64
## sex             65795 non-null object
## years_study     65795 non-null category
## color_race      65795 non-null object
## salary          65795 non-null float64
## civil_status    65795 non-null object
## region          65795 non-null object
## log_salary      65795 non-null float64
## dtypes: category(1), float64(2), int64(2), object(4)
## memory usage: 4.1+ MB</code></pre>
<p>Let’s get going first we need to define which variables we will add to the hypothesis to isolate the factor of salary ~ sex, a simple way of doing that is that if we consider that our sample of individuals is random in nature we could simple compare the means of the individuals given their sex and see if there is a significant difference in their means, we can calculate that by using the standard deviation of the calculated means.</p>
<p>A good graphic to get an idea if these effects would be significant was the bar plots we used in part 1.</p>
<p>But if we are working with Categorical variable we can use a groupby aproach to glimpse at the difference in means</p>
<pre class="python"><code>df_sex_thesis.groupby(&#39;sex&#39;).mean().salary</code></pre>
<pre><code>## sex
## man      14302.491879
## woman    10642.502734
## Name: salary, dtype: float64</code></pre>
<details>
<summary>Group by explanation</summary>
<p>
<p>Group by in pandas is a method that accepts a list of elements in this case just ‘sex’ and applies consequent operation in each group, in this case we applied the mean method from a pandas DataFrame, we used .salary to return just the mean for the salary variable.</p>
</p>
</details>
<pre class="python"><code>df_sex_thesis.groupby([&#39;sex&#39;,&#39;region&#39;]).mean().salary</code></pre>
<pre><code>## sex    region   
## man    midwest      15263.832776
##        north        11645.335382
##        south        15507.600528
##        southeast    14755.538089
## woman  midwest      11394.125688
##        north         9932.078329
##        northeast    24737.436554
##        south        10159.399214
##        southeast    10826.777483
## Name: salary, dtype: float64</code></pre>
<p>Adding standard deviations</p>
<pre class="python"><code>df_sex_thesis.groupby([&#39;sex&#39;]).std().salary</code></pre>
<pre><code>## sex
## man      21832.256493
## woman    11949.880892
## Name: salary, dtype: float64</code></pre>
<p>These are really big Standard deviations! Remembering from stats that +2 SD’s gives about a 95% confidence interval we are not even close.</p>
<p>To add both togheter we can use pandas agg method</p>
<pre class="python"><code>df_sex_thesis.groupby([&#39;sex&#39;]).agg([&#39;mean&#39;,&#39;std&#39;]).salary</code></pre>
<pre><code>##                mean           std
## sex                              
## man    14302.491879  21832.256493
## woman  10642.502734  11949.880892</code></pre>
<p>Now we can calculate boundaries</p>
<pre class="python"><code>df_agg =df_sex_thesis.groupby([&#39;sex&#39;]).agg([&#39;mean&#39;,&#39;std&#39;]).salary</code></pre>
<pre class="python"><code>df_agg</code></pre>
<pre><code>##                mean           std
## sex                              
## man    14302.491879  21832.256493
## woman  10642.502734  11949.880892</code></pre>
<pre class="python"><code>df_agg[&#39;lower_bound&#39;] = df_agg[&#39;mean&#39;] - df_agg[&#39;std&#39;] * 2
df_agg[&#39;upper_bound&#39;] = df_agg[&#39;mean&#39;] + df_agg[&#39;std&#39;] * 2</code></pre>
<pre class="python"><code>df_agg</code></pre>
<pre><code>##                mean           std   lower_bound   upper_bound
## sex                                                          
## man    14302.491879  21832.256493 -29362.021106  57967.004865
## woman  10642.502734  11949.880892 -13257.259050  34542.264519</code></pre>
<p>Cool but to verbose to be repeated we can easily make this series of operation into a function</p>
<pre class="python"><code>def groupby_bound(df,groupby_variables,value_variables):
  df_agg =  df.groupby(groupby_variables).agg([&#39;mean&#39;,&#39;std&#39;])[value_variables]
  df_agg[&#39;lower_bound&#39;] = df_agg[&#39;mean&#39;] - df_agg[&#39;std&#39;] * 2
  df_agg[&#39;upper_bound&#39;] = df_agg[&#39;mean&#39;] + df_agg[&#39;std&#39;] * 2
  return df_agg</code></pre>
<pre class="python"><code>groupby_bound(df=df_sex_thesis,groupby_variables=&#39;sex&#39;,value_variables=&#39;salary&#39;)</code></pre>
<pre><code>##                mean           std   lower_bound   upper_bound
## sex                                                          
## man    14302.491879  21832.256493 -29362.021106  57967.004865
## woman  10642.502734  11949.880892 -13257.259050  34542.264519</code></pre>
<p>Now that we have a working function let’s see if we can find a difference in salary on some strata of the population</p>
<pre class="python"><code>groupby_bound(df=df_sex_thesis,groupby_variables=[&#39;sex&#39;,&#39;region&#39;],value_variables=&#39;salary&#39;)</code></pre>
<pre><code>##                          mean           std   lower_bound   upper_bound
## sex   region                                                           
## man   midwest    15263.832776  22365.162600 -29466.492424  59994.157975
##       north      11645.335382  17755.179348 -23865.023315  47155.694079
##       south      15507.600528  24077.013334 -32646.426140  63661.627196
##       southeast  14755.538089  22471.956377 -30188.374664  59699.450842
## woman midwest    11394.125688  14039.268041 -16684.410394  39472.661770
##       north       9932.078329  10366.150119 -10800.221908  30664.378567
##       northeast  24737.436554  35861.738868 -46986.041182  96460.914290
##       south      10159.399214  10274.792359 -10390.185505  30708.983932
##       southeast  10826.777483  12140.616504 -13454.455526  35108.010491</code></pre>
</div>
</div>
